<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1784px" height="2163px" viewBox="-0.5 -0.5 1784 2163" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2022-04-04T08:24:30.319Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/17.2.4 Chrome/96.0.4664.174 Electron/16.1.0 Safari/537.36&quot; etag=&quot;LRf95nlpjDQ64j9JkmJq&quot; version=&quot;17.2.4&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;aIN8FhLL5N2OEmbihvFK&quot; name=&quot;第 1 页&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 98 601 L 98 601 L 1778 601 L 1778 601" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 98 601 L 98 2161 L 1778 2161 L 1778 601" fill="#33ffff" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><rect x="108" y="606" width="110" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 621px; margin-left: 163px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 19px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap;">framework</div></div></div></foreignObject><text x="163" y="627" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="19px" text-anchor="middle" font-weight="bold">framework</text></switch></g><rect x="138" y="721" width="560" height="1400" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 558px; height: 1px; padding-top: 1421px; margin-left: 140px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div><b style="background-color: rgb(255 , 255 , 0)">对 dma 硬件设备的共性的抽象</b></div><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct</b> <b>dma_device</b></span> {</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> chancnt;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> privatecnt;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head </font>channels;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head </font>global_node;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_cap_mask_t  </font>cap_mask;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned short</font> max_xor;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned short</font> max_pq;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u8 </font>copy_align;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u8 </font>xor_align;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u8 </font>pq_align;</div><div><span>	</span><span style="white-space: pre">	</span>#define <font color="#007fff">DMA_HAS_PQ_CONTINUE</font> (1 &lt;&lt; 15)</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> dev_id;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">device </font>*dev;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u32 </font>src_addr_widths;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u32 </font>dst_addr_widths;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u32 </font>directions;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font> <font color="#006600">dma_residue_granularity </font>residue_granularity;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> (*device_alloc_chan_resources)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> (*device_free_chan_resources)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_memcpy)(</div><div><span>		</span><span style="white-space: pre">	<span style="white-space: pre">	</span></span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#006600">dma_addr_t </font>dst, <font color="#006600">dma_addr_t</font> src,</div><div><span>		</span><span style="white-space: pre">	<span style="white-space: pre">	</span></span><font color="#006600">size_t </font>len, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_xor)(</div><div><span>		</span><span style="white-space: pre">	<span style="white-space: pre">	</span></span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#006600">dma_addr_t </font>dst, <font color="#006600">dma_addr_t </font>*src,</div><div><span>		</span><span style="white-space: pre">	<span style="white-space: pre">	</span></span><font color="#007fff">unsigned int</font> src_cnt, <font color="#006600">size_t </font>len, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_xor_val)(</div><div><span>		</span><span style="white-space: pre">	<span style="white-space: pre">	</span></span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#006600">dma_addr_t </font>*src,<span>	</span><font color="#007fff">unsigned int</font> src_cnt,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#006600">size_t </font>len, <font color="#007fff">enum </font><font color="#006600">sum_check_flags </font>*result, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_pq)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#006600">dma_addr_t </font>*dst, <font color="#006600">dma_addr_t </font>*src,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> src_cnt, <font color="#007fff">const unsigned char</font> *scf,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#006600">size_t </font>len, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_pq_val)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#006600">dma_addr_t </font>*pq, <font color="#006600">dma_addr_t </font>*src,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> src_cnt, <font color="#007fff">const unsigned char</font> *scf, <font color="#006600">size_t </font>len,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font> <font color="#006600">sum_check_flags </font>*pqres, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_interrupt)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_sg)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">scatterlist </font>*dst_sg, <font color="#007fff">unsigned int</font> dst_nents,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">scatterlist </font>*src_sg, <font color="#007fff">unsigned int</font> src_nents,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned long</font> flags);</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_slave_sg)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#007fff">struct</font> <font color="#006600">scatterlist </font>*sgl,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> sg_len, <font color="#007fff">enum</font> <font color="#006600">dma_transfer_direction </font>direction,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned long</font> flags, <font color="#007fff">void</font> *context);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_dma_cyclic)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan</font> *chan, <font color="#006600">dma_addr_t </font>buf_addr, <font color="#006600">size_t </font>buf_len,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#006600">size_t </font>period_len, <font color="#007fff">enum</font> <font color="#006600">dma_transfer_direction </font>direction,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned long</font> flags);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*(*device_prep_interleaved_dma)(</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan, <font color="#007fff">struct</font> <font color="#006600">dma_interleaved_template </font>*xt,</div><div><span>		</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned long</font> flags);</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> (*device_config)(<font color="#007fff">struct </font><font color="#006600">dma_chan </font>*chan,</div><div><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_slave_config </font>*config);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> (*device_pause)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> (*device_resume)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> (*device_terminate_all)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font> <font color="#006600">dma_status </font>(*device_wait_tasklet)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font> <font color="#006600">dma_status </font>(*device_tx_status)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan,</div><div><span>					</span>    <span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#006600">dma_cookie_t </font>cookie,</div><div><span>					</span>    <span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_tx_state </font>*txstate);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> (*device_issue_pending)(<font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan);</div><div>};</div></div></div></div></foreignObject><text x="140" y="1426" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 硬件设备的共性的抽象...</text></switch></g><rect x="778" y="721" width="440" height="320" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 438px; height: 1px; padding-top: 881px; margin-left: 780px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b style="background-color: rgb(255 , 255 , 0)">基于物理 dma 通道，抽象出的虚拟的 dma 通道</b><br /><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct virt_dma_chan</b></span> {</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan</font><span>	</span>chan;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">tasklet_struct</font> task;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> (*desc_free)(<font color="#007fff">struct</font> <font color="#006600">virt_dma_desc</font> *);</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span>spinlock_t lock;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#003300">/* protected by vc.lock */</font></div><div><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head</font> desc_submitted;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head</font> desc_issued;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head</font> desc_completed;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">virt_dma_desc</font> *cyclic;</div><div>};</div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="780" y="886" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">基于物理 dma 通道，抽象出的虚拟的 dma 通道...</text></switch></g><rect x="778" y="1281" width="440" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 438px; height: 1px; padding-top: 1461px; margin-left: 780px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b style="background-color: rgb(255 , 255 , 0)">对 dma 物理通道的共性的抽象</b><br /><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct dma_chan</b></span> {</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_device</font> *device;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_cookie_t </font>cookie;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_cookie_t </font>completed_cookie;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#003300">/* sysfs */</font></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> chan_id;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan_dev </font>*dev;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head </font>device_node;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan_percpu </font>__percpu *local;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> client_count;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">int</font> table_count;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> *private;</div><div>};</div><div><br /></div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="780" y="1466" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 物理通道的共性的抽象...</text></switch></g><rect x="1258" y="721" width="480" height="320" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 478px; height: 1px; padding-top: 881px; margin-left: 1260px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b style="background-color: rgb(255 , 255 , 0)">对 dma 虚拟通道传输进行控制的虚拟通道描述符</b><br /><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct virt_dma_desc</b></span> {</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor</font> tx;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#003300">/* protected by vc.lock */</font></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">list_head</font> node;</div><div><br /></div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> (*overide_callback) (<font color="#007fff">void</font> *overide_param);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> *overide_param;</div><div>};</div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="1260" y="886" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 虚拟通道传输进行控制的虚拟通道描述符...</text></switch></g><rect x="1258" y="1281" width="480" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 478px; height: 1px; padding-top: 1461px; margin-left: 1260px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div><span style="background-color: rgb(255 , 255 , 0)"><b>对 dma 通道传输进行控制的传输描述符</b></span></div><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct dma_async_tx_descriptor</b></span> {</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_cookie_t </font>cookie;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font> <font color="#006600">dma_ctrl_flags </font>flags; /* not a 'long' to pack with cookie <span style="white-space: pre">	</span>*/</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_addr_t </font>phys;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan </font>*chan;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_cookie_t </font>(*tx_submit)(<font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*tx);</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_async_tx_callback </font>callback;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">void</font> *callback_param;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dmaengine_unmap_data </font>*unmap;</div><div>#ifdef CONFIG_ASYNC_TX_ENABLE_CHANNEL_SWITCH</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*next;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_async_tx_descriptor </font>*parent;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">spinlock_t </font>lock;</div><div>#endif</div><div>};</div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="1260" y="1466" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 通道传输进行控制的传输描述符...</text></switch></g><path d="M 929 1336 L 1148 1336 L 1148 1418 L 1280.76 1418" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 1286.76 1418 L 1278.76 1422 L 1280.76 1418 L 1278.76 1414 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 1253 1343 L 1238 1343 L 1238 846 L 1280.76 846" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1286.76 846 L 1278.76 850 L 1280.76 846 L 1278.76 842 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 771 1335 L 728 1335 L 728 793 L 800.76 793" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 806.76 793 L 798.76 797 L 800.76 793 L 798.76 789 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><rect x="778" y="1761" width="440" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 438px; height: 1px; padding-top: 1941px; margin-left: 780px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b style="background-color: rgb(255 , 255 , 0)">对 dma 物理通道的 sysfs 属性的抽象</b><br /><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct dma_chan_dev</b></span> {</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_chan</font> *chan;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">device </font>device;</div><div><span style="white-space: pre">	</span><font color="#007fff">int</font> dev_id;<br /></div><div><span style="white-space: pre">	</span><font color="#007fff">atomic_t</font> *idr_ref;<br /></div><div><span>};</span><br /></div><div><br /></div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="780" y="1946" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 物理通道的 sysfs 属性的抽象...</text></switch></g><path d="M 804 1461 L 728 1461 L 728 1900 L 762.76 1900" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 768.76 1900 L 760.76 1904 L 762.76 1900 L 760.76 1896 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><rect x="1258" y="1761" width="440" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 438px; height: 1px; padding-top: 1941px; margin-left: 1260px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><b style="background-color: rgb(255 , 255 , 0)">对 dma 通道配置的抽象</b><br /><div><span style="background-color: rgb(255 , 255 , 0)"><b>struct dma_slave_config</b></span> {</div><div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum </font><font color="#006600">dma_transfer_direction</font> direction;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_addr_t</font> src_addr;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">dma_addr_t</font> dst_addr;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum</font><font color="#006600"> dma_slave_buswidth</font> src_addr_width;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">enum </font><font color="#006600">dma_slave_buswidth</font> dst_addr_width;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u32 </font>src_maxburst;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#006600">u32</font> dst_maxburst;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">bool </font>device_fc;</div><div><span>	</span><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font> slave_id;</div></div><div><span>};</span><br /></div><div><br /></div><div style="text-align: justify"></div></div></div></div></foreignObject><text x="1260" y="1946" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对 dma 通道配置的抽象...</text></switch></g><path d="M 98 682.12 L 1779.68 683.68" fill="none" stroke="rgb(0, 0, 0)" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 98 1 L 98 1 L 1778 1 L 1778 1" fill="#ffffff" stroke="rgb(0, 0, 0)" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M 98 1 L 98 521 L 1778 521 L 1778 1" fill="#ccffcc" stroke="rgb(0, 0, 0)" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="113" y="11" width="150" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 26px; margin-left: 188px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 19px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: nowrap;">driver-provider</div></div></div></foreignObject><text x="188" y="32" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="19px" text-anchor="middle" font-weight="bold">driver-provider</text></switch></g><rect x="138" y="161" width="560" height="280" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 558px; height: 1px; padding-top: 301px; margin-left: 140px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><span style="background-color: rgb(0 , 255 , 255)">对厂家 dma 硬件设备特性的抽象</span><br /><b style="background-color: rgb(0 , 255 , 255)">struct gsdma_engine </b>{<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">device</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*dev;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">dma_device</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span>dma_device;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">sdma_channel</font><span style="white-space: pre">	</span>*s_channel;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">gdma_channel</font><span style="white-space: pre">	</span>*g_channel;<br /><span style="white-space: pre">	</span><font color="#006600">u32</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>sch_number;<br /><span style="white-space: pre">	</span><br /><span style="white-space: pre">	</span><font color="#007fff">void </font>__iomem<span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*base;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">clk</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*clk;<br /><span style="white-space: pre">	</span><font color="#007fff">int</font> <span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>irq;<br /><span style="white-space: pre">	</span><font color="#006600">spinlock_t</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>lock;<br />};</div></div></div></foreignObject><text x="140" y="306" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对厂家 dma 硬件设备特性的抽象...</text></switch></g><rect x="778" y="161" width="440" height="280" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 438px; height: 1px; padding-top: 301px; margin-left: 780px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><span style="background-color: rgb(0 , 255 , 255)">基于虚拟 dma 通道，对厂家 dma 通道的特性的抽象</span><br /><b style="background-color: rgb(0 , 255 , 255)">struct sdma_channel</b> {<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">gsdma_channel</font><span style="white-space: pre">	</span>*gsdma;<br /><span style="white-space: pre">	</span><font color="#007fff">void </font>__iomem<span style="white-space: pre">	</span><span style="white-space: pre">	<span style="white-space: pre">	</span>*</span>ch_base;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">virt_dma_chan</font><span style="white-space: pre">	</span>vc;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">gdma_desc</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*desc;<br /><span style="white-space: pre">	</span><font color="#007fff">unsigned int</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>id;<br />};<br /><div style="text-align: justify"></div></div></div></div></foreignObject><text x="780" y="306" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">基于虚拟 dma 通道，对厂家 dma 通道的特性的抽象...</text></switch></g><rect x="1258" y="161" width="480" height="280" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 478px; height: 1px; padding-top: 301px; margin-left: 1260px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><span style="background-color: rgb(0 , 255 , 255)">对厂家 dma 通道传输进行控制的特有的描述符</span><br /><span style="background-color: rgb(0 , 255 , 255)"><b>struct sdma_desc</b></span> {<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">sdma_llt</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*llt_entry;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">virt_dma_desc</font><span style="white-space: pre">	</span>vd;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">sdma_channel</font><span style="white-space: pre">	</span>*sdmac;<br /><span style="white-space: pre">	</span><font color="#006600">dma_addr_t</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>phys_llt_addr;<br /><span style="white-space: pre">	</span><font color="#007fff">struct</font> <font color="#006600">sdma_llt</font><span style="white-space: pre">	</span><span style="white-space: pre">	</span><span style="white-space: pre">	</span>*virt_llt_addr;<br /><span style="white-space: pre">	</span><br />};<br /><div style="text-align: justify"></div></div></div></div></foreignObject><text x="1260" y="306" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="15px">对厂家 dma 通道传输进行控制的特有的描述符...</text></switch></g><path d="M 429 266 L 766.76 266" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 772.76 266 L 764.76 270 L 766.76 266 L 764.76 262 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 800.76 311 L 728 311 L 728 776 L 772 776" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 806.76 311 L 798.76 315 L 800.76 311 L 798.76 307 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 98 50.4 L 1778 50.4" fill="none" stroke="rgb(0, 0, 0)" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 156.76 248 L 8 248 L 8 780 L 133 780" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 162.76 248 L 154.76 252 L 156.76 248 L 154.76 244 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 1036 330 L 1148 331 L 1148 248 L 1241.76 248" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 1247.76 248 L 1239.76 252 L 1241.76 248 L 1239.76 244 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>